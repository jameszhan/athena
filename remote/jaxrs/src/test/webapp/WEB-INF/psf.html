<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<title>Psf Dev Tool</title>
<style type="text/css">

input {
	width: 100px;
}

.button{	
	padding:3px 3px;
}

#rbf a {
	padding: 2px;
	color: #ff3300;
	font-size: 18px;
	font-weight: bolder;
	text-decoration: none;
}

#psfRequestTable td {
	vertical-align: top;
}

#loadingBar {
	background-color: #ff3300;
	position: absolute;
	display: none;
	width: 80px;
	float: right;
}
.tab-title,
.tab-title li{
	margin:0;
    padding:0;
    list-style:none;
}

.tab-title {
    border:solid #2647a0;
    border-width:0 0 5px;
    zoom:1;
	position:relative; 
}

.tab-title li{
    margin:0 0.05em -0.3em 0;
    padding:1px 0 0;
    zoom:1;
	display:inline-block;
    *display:inline; /* IE */
    vertical-align:bottom; /* safari: for overlap */
    cursor:pointer;
}

.tab-title li.selected {   
	margin-bottom:0;
}

.tab-title li a{    
    border:solid #a3a3a3;
    border-width: 1px 1px 0 1px;
    color:#000;
    cursor:pointer;
    font-size:85%;
    padding:0.3em .75em;
    text-decoration:none;
	display:block;
    display:inline-block;
    padding:6px 10px;
    position:relative; /* IE: to allow overlap */
    text-decoration: none;
    vertical-align:bottom; /* safari: for overlap */
}

.tab-title .selected a,
.tab-title .selected a:focus,
.tab-title .selected a:hover {    
	background:#2647a0; 
    color:#fff;
}

.tab-title .selected a {
    padding:0.4em 0.75em; 
	border-color:#243356;
}

.tab-content {
    background:#edf5ff;
	border:1px solid #808080; 
    border-top-color:#243356; 
    padding:0.1em 0.25em 0.25em 0.1em; 
}

.tab-content .hide{
	display:none;
} 

img.mouseout {	
	cursor: pointer;	
	filter: alpha(opacity=50);
	-moz-opacity: 0.5;
	-khtml-opacity: 0.5;
	opacity: 0.5;
}

#psfServiceHost{
	width:220px;
}

img.mouseover {	
	cursor: pointer;	
	filter: alpha(opacity=100);
	-moz-opacity: 1.0;
	-khtml-opacity: 1.0;
	opacity: 1.0;
}

div.group{
	border: #cfcfcf solid 1px;
	padding: 1px;
	margin-bottom: 5px;
}

div.op{
	text-align:right; 
	margin:-1px -1px -1px 0;	
}

div.op > img{
	cursor: pointer;	
}
</style>
<script type="text/javascript" src="/media/scripts/jquery-1.6.2.js"></script>

<script type="text/javascript">
	$(function() {	
	    $("#psfServiceHost").change(function(){
	        var urlTest = /https?:\/\/(\w*:\w*@)?[-\w.]+(:\d+)?(\/([\w/_.]*(\?\S+)?)?)?/;
			var url = $("#psfServiceHost").val();
			if(urlTest.test(url)) {
			 	url = url.replace(/\/*$/, "");
			 	$("#psfServiceHost").val(url);
			 } else {
			    alert("Not a Url, Please enter a correct url.");
			    $("#psfServiceHost").focus();
			 }
		});	
		function text(name, ctx){
			return $("input:text[name=" + name + "]", ctx).val();
		}
		
		function hover($obj){
			return $obj.hover(function(){
				$(this).removeClass('mouseout').addClass('mouseover');
			}, function(){
				$(this).removeClass('mouseover').addClass('mouseout');
			});			
		}
		
		function close_tag(desc, fn){
			var fun = fn || function(){
				$(this).parent().parent().remove();
			};
			return hover($('<img src="/static/artifacts/images/psf/close.png" class="mouseout" title="' + desc + '" />')).click(fun);
		}
		
		var dealGroupTemplate = $("#dealGroups > .group");
		var psfSortTemplate = $("#psfSorts > .group");
		
		hover($("#moreDealGroups")).click(function(){
			var newDealGroup = dealGroupTemplate.clone();
			newDealGroup.find('.op > img').replaceWith(close_tag('delete current deal group.'));
			$("#dealGroups").append(newDealGroup);			
		});
		
		hover($("#moreSorts")).click(function(){
			var newPsfSort = psfSortTemplate.clone();
			newPsfSort.find('.op > img').replaceWith(close_tag('delete current sort.'));
			$("#psfSorts").append(newPsfSort);			
		});
		
		hover($("#moreRequiredFieldNames")).click(function(){					
			$("#requiredFiledNamesTD").append($('<div></div>')
				.append('<input type="text" name="requiredFieldNames" value="headline" /> ')
				.append(close_tag('delete required field name.', function(){
					$(this).parent().remove();
				})));
		});
				
		$("#buildRequest").click(function(){
			$(this).attr('disabled', true);
			var f = $("#rbf");
			var indent = "   ";
			var psf = '<\@ui.psf viewName="ftl:controls/psf/view" viewRegion="1" responseType="'
				+ $('select[name=responseType]', f).val() + '" fields="';				
			
			var rq = '<psfRequest clientId="' + text("clientId", f) + '">\n';	
			var clientId = indent + '<\@ui.property name="clientId" value="' + text("clientId", f) + '" />\n';			
			var pps = "";
			$("#dealGroups table").each(function(i, e){			
				var ctx = $(e);
				pps += indent + '<\@ui.pagePosition position=' + text("positionId", ctx)  + ' pageId=' 
					+ text("pageId", ctx) + ' dealCount=' + text("dealCount", ctx) + ' types="';
				rq += indent + '<dealGroup pageId="' + text("pageId", ctx) + '" positionId="' + text("positionId", ctx) 
					+ '" dealCount="' + text("dealCount", ctx) + '">\n';
				$("select[name=productTypes] > option:selected", ctx).each(function(i, e){					
					rq += indent + indent + '<productType>' + e.value + '</productType>\n';
					pps += e.value + ",";
				});
				rq += indent + '</dealGroup>\n';		
				pps = pps.substr(0, pps.length - 1) + '">\n';
			});	
			
			$("#psfSorts table").each(function(i, e){			
				var ctx = $(e);
				pps += indent + '<\@ui.sort fieldName="' + text("sortField", ctx) + '" direction="' 
					+ $("select[name=sortDirection]", ctx).val() + '" />\n';	
				rq += indent + '<sort fieldName="' + text("sortField", ctx) + '" direction="' 
					+ $("select[name=sortDirection]", ctx).val() + '" />\n';			
			});	
			
			$("input:text[name=requiredFieldNames]", f).each(function(i, e){
				psf += $(e).val() + ",";
				rq += indent + '<requiredFieldName>' + $(e).val() + '</requiredFieldName>\n';
			});
			psf = psf.substr(0, psf.length - 1) + '">\n';
			psf += clientId + pps + '</\@ui.psf>';
			
			rq += "</psfRequest>";
			$("#psfRequest").val(rq);
			$("#psfUIShow").val(psf);
			$(this).removeAttr('disabled');
		});
		
		$("#sendRequest").click(function(){
			$(this).attr('disabled', true);
			var rq = $.trim($("#psfRequest").val());
			$("#psfResponse").val("Loading...");		
			alert(rq);
			$.ajax({
				type: 'POST',
				url: '/a.d',
				data: rq,
				dataType: 'text',
				cache: false,	
				beforeSend: function(http){
					var accept = $('select[name=responseType]', $("#rbf")).val();
					http.setRequestHeader('Accept', accept);			
				},
				success: function(rs){
					$("#psfResponse").val(rs);		
				}				
			});	
		}).ajaxComplete(function(evt, request, options) {
			$(this).removeAttr('disabled');
		}).ajaxError(function(evt, request, options, err){
			alert("Trigger ajaxError: " + err);	
			$(this).removeAttr('disabled');
		});		
		
		$('#loadingBar').ajaxStart(function(evt, request, options) {
			$(this).show();
		});
		
		$('#loadingBar').ajaxStop(function(evt, request, options) {
			$(this).hide();
		});		
		
		function proxy(url, start, callback, complete){
			$.ajax({
				type: 'GET',
				url: '/devtools/psf/genericSearch',
				data: 'genericSearchUrl=' + url,
				dataType: 'text',
				beforeSend: start,
				success: callback,
				cache: false,				
				complete: complete
			});
		}
		
		var beginSend = function(http){			
			var accept = $('#accpetContentType').val();
			http.setRequestHeader('Accept', accept);
			$('#psfRequest').append("\r\nAccept Content Type:" + accept);
		};
		
		var success = function(rs){
			$("#psfResponse").val(rs);	
		}		
		
		$("#listAllPageId").click(function(){
			$(this).attr('disabled', true);
			var url = $("#psfServiceHost").val() + "/devtool";
			$("#psfUIShow").empty();
			$('#psfRequest').empty().append('url: ' + url);
			
			proxy(url, beginSend, success, function(){
				$('#listAllPageId').removeAttr('disabled');
			});		
		});
		
		$("#getPageInfo").click(function(){
			$(this).attr('disabled', true);			
			var url = $("#psfServiceHost").val() + "/devtool/" + $('#pageId').val();
			$("#psfUIShow").empty();
			$('#psfRequest').empty().append('url: ' + url);
			
			proxy(url, beginSend, success, function(){
				$('#getPageInfo').removeAttr('disabled');
			});	
		});
		
		function init_tabs(){
			$(".tabs > ul").addClass("tab-title");
			$(".tabs > div").addClass("tab-content");			
			$(".tab-title > li > a").click(function(e) {
				if (e.target == this) {
					var titles = $(this).parentsUntil('.tabs').children('li');			
					var contents = $(this).parentsUntil('.tabs').next('.tab-content').children('div');	
					var index = $.inArray(this, titles.children('a'));	 			
					if(titles.length <= contents.length){
						titles.removeClass("selected").eq(index).addClass("selected");
						contents.addClass("hide").eq(index).removeClass("hide");
					}	               
				}
			});
			
			$('.tab-title').each(function(i, e){
				$(e).find('li >  a').eq(0).click();
			});		
		}
		init_tabs();
		$("#buildRequest").click();	
		$("#psfDetailsRequestLink").click();
	});
</script>
</head>
<body bgcolor="#ffffff" text="#000000" link="#0000cc" vlink="#551a8b" alink="#ff0000">

<div id="psfdevtoolpage">

<div style="float:left; width:32%; height:100%;">
<div class="tabs" style="width:100%;">
    <ul>
        <li><a href="#">Psf Generic Request</a></li>
        <li><a href="#" id="psfDetailsRequestLink">Psf Details Request</a></li>
    </ul>
    <div>
      <br/>
      <label>&nbsp;&nbsp;Psf Service Host:</label> 
      <input type="text" id="psfServiceHost" name="psfServiceHost" value="http://localhost:8080"/>
	<div>
	<ol class="pgrl">
		Accept Content Type:
		<select id="accpetContentType">
			<option value="application/xml" selected="selected">xml  </option>
			<option value="application/json">json  </option>													 
		</select>
		<li><button id="listAllPageId">List All PageId</button></li>
		<li>
        	<input type="text" value="5926" style="width:50px;" id="pageId" />
            <button id="getPageInfo">Get Page Info</button>
		</li>
		<li>        	
            <a href="/devtools/publishing/psf" target="_blank">Psf UI Tag Demo</a>
		</li>	
		<li>        	
            <a href="/devtools/psfPage" target="_blank">Legacy PSF Demo</a>
		</li>	
	</ol>
	</div>		
	<div style="margin:10px; padding:1px 10px 1px 10px; background-color:#FCFCFC;">       
		<form action="/devtools/psf/search" name="RequestBuilderForm" id="rbf">
			<table id="psfRequestTable">
				<tr>
					<td>ClientId: </td>
					<td><input type="text" name="clientId" value="PsfClient" /></td>
				</tr>
				<tr>
					<td>ResponseType: </td>
					<td>
						<select name="responseType">
							<option value="application/xml" selected="selected">xml  </option>
							<option value="application/json">json  </option>													 
						</select>
					</td>
				</tr>
				<tr>
					<td>DealGroups: </td>
					<td>
					<fieldset style="padding:5px;" id="dealGroups">
					<legend>Deal Groups</legend>						
					<div class="group">
						<div class="op"><img src="/static/artifacts/images/psf/add.png" class="mouseout" id="moreDealGroups" title="Add more deal groups." /></div>                    
						<table align="center">
							<tr>
								<td>DealCount:</td>
								<td><input type="text" name="dealCount" value="20" /></td>
							</tr>
							<tr>
								<td>PageId:</td>
								<td><input type="text" name="pageId" value="5925" /></td>
							</tr>
							<tr>
								<td>PositionId:</td>
								<td><input type="text" name="positionId" value="1" /></td>
							</tr>
							<tr>
								<td>productTypes</td>
								<td>
								<select multiple="multiple" name="productTypes" size="3">
									<option value="epackages" selected="selected">epackages</option>
									<option value="flights">flights</option>
									<option value="hotels">hotels</option>
									<option value="promo">promo</option>
									<option value="cars">cars</option>
									<option value="trttop">trttop</option>							 
								</select>
								</td>		
							</tr>
						</table>
					</div>
					</fieldset>
					</td>			
				</tr>
				<tr>
					<td>Sorts: </td>
					<td>						
                    <fieldset style="padding:5px;" id="psfSorts">
                    <legend>Sort</legend>	
					<div class="group">
                        <div class="op"><img src="/static/artifacts/images/psf/add.png" class="mouseout" title="Add more psf sorts." id="moreSorts" /></div>											
						<table>
							<tr>
								<td>Field Name:</td>
								<td><input type="text" name="sortField" value="headline" /></td>
							</tr>	
							<tr>
								<td>Sort Direction:</td>
								<td><select name="sortDirection">
									<option value="ASC" selected="selected">ascending</option>
									<option value="DESC">descending</option>													 
								</select></td>
							</tr>				
						</table>
					</div>
					</fieldset>                        
					</td>			
				</tr>
				<tr>
					<td>RequiredFieldNames: </td>
					<td id="requiredFiledNamesTD">
                    	<div><input type="text" name="requiredFieldNames" value="headline" />
                        <img src="/static/artifacts/images/psf/add.png" class="mouseout" title="Add New Required Field Name." id="moreRequiredFieldNames" /></div>
                    </td>			
				</tr>	
				<tr><td colspan="2" height="10"></td></tr>				
			</table>
            <div style="text-align:right"><button type="button" class="button" id="buildRequest">Build Request</button></div>	
		</form>
		</div>
    </div>
</div>
</div>

<div style="width:3%; height:100%; float:left; visibility:hidden" id="separator">This use to separate left and right.</div>

<div style="float:left; width:50%; height:100%;">
<div class="tabs">
    <ul>
        <li><a href="#">Psf UI Tag</a></li>
        <li><a href="#">Psf Request</a></li>
    </ul>
    <div>
        <div><textarea id="psfUIShow" cols="80" rows="20" style="width:99%;">Psf UI Show</textarea></div>
        <div><textarea id="psfRequest" cols="80" rows="20" style="width:99%;">Psf Request.</textarea></div>
        <span style="width:99%; text-align:right; display:block;"><button type="button" class="button" id="sendRequest">Send Request</button></span>
    </div>	
</div>
<br />
<div class="tabs">
    <ul>
        <li><a href="#">PSF Response</a></li>      
    </ul>
    <div>
        <div><textarea id="psfResponse" cols="80" rows="20" style="width:99%;"></textarea></div>       
    </div>
</div>

</div>

</div>

<div id="loadingBar">Loading...</div>
</body>
</html>